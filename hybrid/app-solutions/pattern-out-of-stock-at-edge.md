---
title: Fora da deteção de stock usando Azure e Azure Stack Edge
description: Saiba como utilizar os serviços Azure e Azure Stack Edge para implementar fora da deteção de stock.
author: BryanLa
ms.topic: article
ms.date: 05/24/2021
ms.author: bryanla
ms.reviewer: anajod
ms.lastreviewed: 05/24/2021
ms.openlocfilehash: b25a6391c4e64fa7018031bac4fb7d098c56b529
ms.sourcegitcommit: cf2c4033d1b169f5b63980ce1865281366905e2e
ms.translationtype: MT
ms.contentlocale: pt-PT
ms.lasthandoff: 05/25/2021
ms.locfileid: "110343880"
---
# <a name="out-of-stock-detection-at-the-edge-pattern"></a><span data-ttu-id="387a8-103">Fora da deteção de stock no padrão de borda</span><span class="sxs-lookup"><span data-stu-id="387a8-103">Out of stock detection at the edge pattern</span></span>

<span data-ttu-id="387a8-104">Este padrão ilustra como determinar se as prateleiras estão esgotadas usando um dispositivo Azure Stack Edge ou Azure IoT Edge e câmaras de rede.</span><span class="sxs-lookup"><span data-stu-id="387a8-104">This pattern illustrates how to determine if shelves have out of stock items using an Azure Stack Edge or Azure IoT Edge device and network cameras.</span></span>

## <a name="context-and-problem"></a><span data-ttu-id="387a8-105">Contexto e problema</span><span class="sxs-lookup"><span data-stu-id="387a8-105">Context and problem</span></span>

<span data-ttu-id="387a8-106">As lojas de retalho físico perdem vendas porque quando os clientes procuram um item, não está presente na prateleira.</span><span class="sxs-lookup"><span data-stu-id="387a8-106">Physical retail stores lose sales because when customers look for an item, it's not present on the shelf.</span></span> <span data-ttu-id="387a8-107">No entanto, o artigo poderia estar na parte de trás da loja e não ter sido reabastecido.</span><span class="sxs-lookup"><span data-stu-id="387a8-107">However, the item could have been in the back of the store and not been restocked.</span></span> <span data-ttu-id="387a8-108">As lojas gostariam de utilizar o seu pessoal de forma mais eficiente e ser automaticamente notificadas quando os itens precisam de reabastecimento.</span><span class="sxs-lookup"><span data-stu-id="387a8-108">Stores would like to use their staff more efficiently and get automatically notified when items need restocking.</span></span>

## <a name="solution"></a><span data-ttu-id="387a8-109">Solução</span><span class="sxs-lookup"><span data-stu-id="387a8-109">Solution</span></span>

<span data-ttu-id="387a8-110">O exemplo da solução utiliza um dispositivo de borda, como um Azure Stack Edge em cada loja, que processa eficientemente dados de câmaras na loja.</span><span class="sxs-lookup"><span data-stu-id="387a8-110">The solution example uses an edge device, like an Azure Stack Edge in each store, which efficiently processes data from cameras in the store.</span></span> <span data-ttu-id="387a8-111">Este design otimizado permite que as lojas enviem apenas eventos e imagens relevantes para a nuvem.</span><span class="sxs-lookup"><span data-stu-id="387a8-111">This optimized design lets stores send only relevant events and images to the cloud.</span></span> <span data-ttu-id="387a8-112">O design poupa largura de banda, espaço de armazenamento e garante a privacidade do cliente.</span><span class="sxs-lookup"><span data-stu-id="387a8-112">The design saves bandwidth, storage space, and ensures customer privacy.</span></span> <span data-ttu-id="387a8-113">À medida que os quadros são lidos a partir de cada câmara, um modelo ML processa a imagem e devolve qualquer uma das áreas de stock.</span><span class="sxs-lookup"><span data-stu-id="387a8-113">As frames are read from each camera, an ML model processes the image and returns any out of stock areas.</span></span> <span data-ttu-id="387a8-114">A imagem e fora das áreas de stock são exibidas numa aplicação web local.</span><span class="sxs-lookup"><span data-stu-id="387a8-114">The image and out of stock areas are displayed on a local web app.</span></span> <span data-ttu-id="387a8-115">Estes dados podem ser enviados para um ambiente de Insight da Série Temporal para mostrar insights no Power BI.</span><span class="sxs-lookup"><span data-stu-id="387a8-115">This data can be sent to a Time Series Insight environment to show insights in Power BI.</span></span>

![Fora de stock na arquitetura de solução de borda](media/pattern-out-of-stock-at-edge/solution-architecture.png)

<span data-ttu-id="387a8-117">Eis como funciona a solução:</span><span class="sxs-lookup"><span data-stu-id="387a8-117">Here's how the solution works:</span></span>

1. <span data-ttu-id="387a8-118">As imagens são captadas a partir de uma câmara de rede sobre HTTP ou RTSP.</span><span class="sxs-lookup"><span data-stu-id="387a8-118">Images are captured from a network camera over HTTP or RTSP.</span></span>
2. <span data-ttu-id="387a8-119">A imagem é redimensionada e enviada para o controlador de inferência, que comunica com o modelo ML para determinar se há alguma saída de imagens de stock.</span><span class="sxs-lookup"><span data-stu-id="387a8-119">The image is resized and sent to the inference driver, which communicates with the ML model to determine if there are any out of stock images.</span></span>
3. <span data-ttu-id="387a8-120">O modelo ML devolve qualquer uma das áreas de stock.</span><span class="sxs-lookup"><span data-stu-id="387a8-120">The ML model returns any out of stock areas.</span></span>
4. <span data-ttu-id="387a8-121">O controlador de inferenculação envia a imagem em bruto para uma bolha (se especificada), e envia os resultados do modelo para o Azure IoT Hub e um processador de caixa de delimitação no dispositivo.</span><span class="sxs-lookup"><span data-stu-id="387a8-121">The inferencing driver uploads the raw image to a blob (if specified), and sends the results from the model to Azure IoT Hub and a bounding box processor on the device.</span></span>
5. <span data-ttu-id="387a8-122">O processador de caixa de delimitação adiciona caixas de delimitação à imagem e cache o caminho da imagem numa base de dados de memória.</span><span class="sxs-lookup"><span data-stu-id="387a8-122">The bounding box processor adds bounding boxes to the image and caches the image path in an in-memory database.</span></span>
6. <span data-ttu-id="387a8-123">A aplicação web consulta para imagens e mostra-as na ordem recebida.</span><span class="sxs-lookup"><span data-stu-id="387a8-123">The web app queries for images and shows them in the order received.</span></span>
7. <span data-ttu-id="387a8-124">As mensagens do IoT Hub são agregadas no Time Series Insights.</span><span class="sxs-lookup"><span data-stu-id="387a8-124">Messages from IoT Hub are aggregated in Time Series Insights.</span></span>
8. <span data-ttu-id="387a8-125">Power BI exibe um relatório interativo de itens fora de stock ao longo do tempo com os dados da Time Series Insights.</span><span class="sxs-lookup"><span data-stu-id="387a8-125">Power BI displays an interactive report of out of stock items over time with the data from Time Series Insights.</span></span>


## <a name="components"></a><span data-ttu-id="387a8-126">Componentes</span><span class="sxs-lookup"><span data-stu-id="387a8-126">Components</span></span>

<span data-ttu-id="387a8-127">Esta solução utiliza os seguintes componentes:</span><span class="sxs-lookup"><span data-stu-id="387a8-127">This solution uses the following components:</span></span>

| <span data-ttu-id="387a8-128">Camada</span><span class="sxs-lookup"><span data-stu-id="387a8-128">Layer</span></span> | <span data-ttu-id="387a8-129">Componente</span><span class="sxs-lookup"><span data-stu-id="387a8-129">Component</span></span> | <span data-ttu-id="387a8-130">Descrição</span><span class="sxs-lookup"><span data-stu-id="387a8-130">Description</span></span> |
|----------|-----------|-------------|
| <span data-ttu-id="387a8-131">Hardware no local</span><span class="sxs-lookup"><span data-stu-id="387a8-131">On-premises hardware</span></span> | <span data-ttu-id="387a8-132">Câmera de rede</span><span class="sxs-lookup"><span data-stu-id="387a8-132">Network camera</span></span> | <span data-ttu-id="387a8-133">É necessária uma câmara de rede, com um feed HTTP ou RTSP para fornecer as imagens para inferência.</span><span class="sxs-lookup"><span data-stu-id="387a8-133">A network camera is required, with either an HTTP or RTSP feed to provide the images for inference.</span></span> |
| <span data-ttu-id="387a8-134">Azure</span><span class="sxs-lookup"><span data-stu-id="387a8-134">Azure</span></span> | <span data-ttu-id="387a8-135">Hub IoT do Azure</span><span class="sxs-lookup"><span data-stu-id="387a8-135">Azure IoT Hub</span></span> | <span data-ttu-id="387a8-136">[O Azure IoT Hub](/azure/iot-hub/) trata do fornecimento e mensagens dos dispositivos de borda.</span><span class="sxs-lookup"><span data-stu-id="387a8-136">[Azure IoT Hub](/azure/iot-hub/) handles device provisioning and messaging for the edge devices.</span></span> |
|  | <span data-ttu-id="387a8-137">Azure Time Series Insights</span><span class="sxs-lookup"><span data-stu-id="387a8-137">Azure Time Series Insights</span></span> | <span data-ttu-id="387a8-138">[Azure Time Series Insights](/azure/time-series-insights/) armazena as mensagens do IoT Hub para visualização.</span><span class="sxs-lookup"><span data-stu-id="387a8-138">[Azure Time Series Insights](/azure/time-series-insights/) stores the messages from IoT Hub for visualization.</span></span> |
|  | <span data-ttu-id="387a8-139">Power BI</span><span class="sxs-lookup"><span data-stu-id="387a8-139">Power BI</span></span> | <span data-ttu-id="387a8-140">[O Microsoft Power BI](https://powerbi.microsoft.com/) fornece relatórios focados no negócio de eventos fora de stock.</span><span class="sxs-lookup"><span data-stu-id="387a8-140">[Microsoft Power BI](https://powerbi.microsoft.com/) provides business-focused reports of out of stock events.</span></span> <span data-ttu-id="387a8-141">O Power BI fornece uma interface de painel fácil de usar para visualizar a saída do Azure Stream Analytics.</span><span class="sxs-lookup"><span data-stu-id="387a8-141">Power BI provides an easy-to-use dashboard interface for viewing the output from Azure Stream Analytics.</span></span> |
| <span data-ttu-id="387a8-142">Azure Stack Edge ou</span><span class="sxs-lookup"><span data-stu-id="387a8-142">Azure Stack Edge or</span></span><br><span data-ttu-id="387a8-143">Dispositivo Azure IoT Edge</span><span class="sxs-lookup"><span data-stu-id="387a8-143">Azure IoT Edge device</span></span> | <span data-ttu-id="387a8-144">Azure IoT Edge</span><span class="sxs-lookup"><span data-stu-id="387a8-144">Azure IoT Edge</span></span> | <span data-ttu-id="387a8-145">[O Azure IoT Edge](/azure/iot-edge/) orquestra o tempo de funcionamento dos contentores no local e trata da gestão e atualizações dos dispositivos.</span><span class="sxs-lookup"><span data-stu-id="387a8-145">[Azure IoT Edge](/azure/iot-edge/) orchestrates the runtime for the on-premises containers and handles device management and updates.</span></span>|
| | <span data-ttu-id="387a8-146">Onda cerebral do projeto Azure</span><span class="sxs-lookup"><span data-stu-id="387a8-146">Azure project brainwave</span></span> | <span data-ttu-id="387a8-147">Num dispositivo Azure Stack Edge, [o Project Brainwave](https://blogs.microsoft.com/ai/build-2018-project-brainwave/) utiliza Field-Programmable Gate Arrays (FPGAs) para acelerar a inferição de ML.</span><span class="sxs-lookup"><span data-stu-id="387a8-147">On an Azure Stack Edge device, [Project Brainwave](https://blogs.microsoft.com/ai/build-2018-project-brainwave/) uses Field-Programmable Gate Arrays (FPGAs) to accelerate ML inferencing.</span></span>|

## <a name="issues-and-considerations"></a><span data-ttu-id="387a8-148">Problemas e considerações</span><span class="sxs-lookup"><span data-stu-id="387a8-148">Issues and considerations</span></span>

<span data-ttu-id="387a8-149">Considere os seguintes pontos ao decidir como implementar esta solução:</span><span class="sxs-lookup"><span data-stu-id="387a8-149">Consider the following points when deciding how to implement this solution:</span></span>

### <a name="scalability"></a><span data-ttu-id="387a8-150">Escalabilidade</span><span class="sxs-lookup"><span data-stu-id="387a8-150">Scalability</span></span>

<span data-ttu-id="387a8-151">A maioria dos modelos de machine learning só pode funcionar com um certo número de fotogramas por segundo, dependendo do hardware fornecido.</span><span class="sxs-lookup"><span data-stu-id="387a8-151">Most machine learning models can only run at a certain number of frames per second, depending on the provided hardware.</span></span> <span data-ttu-id="387a8-152">Determine a taxa de amostra ideal da(s) das suas câmaras para garantir que o gasoduto ML não recua.</span><span class="sxs-lookup"><span data-stu-id="387a8-152">Determine the optimal sample rate from your camera(s) to ensure that the ML pipeline doesn't back up.</span></span> <span data-ttu-id="387a8-153">Diferentes tipos de hardware lidarão com diferentes números de câmaras e taxas de fotogramas.</span><span class="sxs-lookup"><span data-stu-id="387a8-153">Different types of hardware will handle different numbers of cameras and frame rates.</span></span>

### <a name="availability"></a><span data-ttu-id="387a8-154">Disponibilidade</span><span class="sxs-lookup"><span data-stu-id="387a8-154">Availability</span></span>

<span data-ttu-id="387a8-155">É importante considerar o que pode acontecer se o dispositivo de borda perder conectividade.</span><span class="sxs-lookup"><span data-stu-id="387a8-155">It's important to consider what might happen if the edge device loses connectivity.</span></span> <span data-ttu-id="387a8-156">Considere quais os dados que podem ser perdidos do painel Time Series Insights e Power BI.</span><span class="sxs-lookup"><span data-stu-id="387a8-156">Consider what data might be lost from the Time Series Insights and Power BI dashboard.</span></span> <span data-ttu-id="387a8-157">A solução de exemplo fornecida não é projetada para ser altamente disponível.</span><span class="sxs-lookup"><span data-stu-id="387a8-157">The example solution as provided isn't designed to be highly available.</span></span>

### <a name="manageability"></a><span data-ttu-id="387a8-158">Capacidade de gestão</span><span class="sxs-lookup"><span data-stu-id="387a8-158">Manageability</span></span>

<span data-ttu-id="387a8-159">Esta solução pode abranger muitos dispositivos e locais, o que pode ficar instável.</span><span class="sxs-lookup"><span data-stu-id="387a8-159">This solution can span many devices and locations, which could get unwieldy.</span></span> <span data-ttu-id="387a8-160">Os serviços IoT da Azure podem automaticamente trazer novos locais e dispositivos on-line e mantê-los atualizados.</span><span class="sxs-lookup"><span data-stu-id="387a8-160">Azure's IoT services can automatically bring new locations and devices online and keep them up to date.</span></span> <span data-ttu-id="387a8-161">Devem também ser seguidos os procedimentos adequados de governação dos dados.</span><span class="sxs-lookup"><span data-stu-id="387a8-161">Proper data governance procedures must be followed as well.</span></span>

### <a name="security"></a><span data-ttu-id="387a8-162">Segurança</span><span class="sxs-lookup"><span data-stu-id="387a8-162">Security</span></span>

<span data-ttu-id="387a8-163">Este padrão lida com dados potencialmente sensíveis.</span><span class="sxs-lookup"><span data-stu-id="387a8-163">This pattern handles potentially sensitive data.</span></span> <span data-ttu-id="387a8-164">Certifique-se de que as chaves são regularmente rodadas e que as permissões na Conta de Armazenamento Azure e nas ações locais estão corretamente definidas.</span><span class="sxs-lookup"><span data-stu-id="387a8-164">Make sure keys are regularly rotated and the permissions on the Azure Storage Account and local shares are correctly set.</span></span>

## <a name="next-steps"></a><span data-ttu-id="387a8-165">Passos seguintes</span><span class="sxs-lookup"><span data-stu-id="387a8-165">Next steps</span></span>

<span data-ttu-id="387a8-166">Para saber mais sobre os tópicos introduzidos neste artigo:</span><span class="sxs-lookup"><span data-stu-id="387a8-166">To learn more about topics introduced in this article:</span></span>
- <span data-ttu-id="387a8-167">Vários serviços relacionados com IoT são utilizados neste padrão, incluindo [Azure IoT Edge,](/azure/iot-edge/) [Azure IoT Hub,](/azure/iot-hub/)e [Azure Time Series Insights](/azure/time-series-insights/).</span><span class="sxs-lookup"><span data-stu-id="387a8-167">Multiple IoT related services are used in this pattern, including [Azure IoT Edge](/azure/iot-edge/), [Azure IoT Hub](/azure/iot-hub/), and [Azure Time Series Insights](/azure/time-series-insights/).</span></span>
- <span data-ttu-id="387a8-168">Para saber mais sobre o Microsoft Project Brainwave, consulte [o anúncio do blog](https://blogs.microsoft.com/ai/build-2018-project-brainwave/) e confira o [Azure Accelerated Machine Learning com o vídeo do Project Brainwave](https://www.youtube.com/watch?v=DJfMobMjCX0).</span><span class="sxs-lookup"><span data-stu-id="387a8-168">To learn more about Microsoft Project Brainwave, see [the blog announcement](https://blogs.microsoft.com/ai/build-2018-project-brainwave/) and checkout out the [Azure Accelerated Machine Learning with Project Brainwave video](https://www.youtube.com/watch?v=DJfMobMjCX0).</span></span>
- <span data-ttu-id="387a8-169">Consulte [considerações de design de aplicativos Híbridos](overview-app-design-considerations.md) para saber mais sobre as melhores práticas e para obter respostas a quaisquer perguntas adicionais.</span><span class="sxs-lookup"><span data-stu-id="387a8-169">See [Hybrid app design considerations](overview-app-design-considerations.md) to learn more about best practices and to get answers to any additional questions.</span></span>
- <span data-ttu-id="387a8-170">Veja a [família de produtos e soluções Azure Stack](/azure-stack) para saber mais sobre todo o portfólio de produtos e soluções.</span><span class="sxs-lookup"><span data-stu-id="387a8-170">See the [Azure Stack family of products and solutions](/azure-stack) to learn more about the entire portfolio of products and solutions.</span></span>

<span data-ttu-id="387a8-171">Quando estiver pronto para testar o exemplo da solução, continue com o guia de implementação da [solução de inferenculação Edge ML](https://aka.ms/edgeinferencingdeploy).</span><span class="sxs-lookup"><span data-stu-id="387a8-171">When you're ready to test the solution example, continue with the [Edge ML inferencing solution deployment guide](https://aka.ms/edgeinferencingdeploy).</span></span> <span data-ttu-id="387a8-172">O guia de implantação fornece instruções passo a passo para a implantação e teste dos seus componentes.</span><span class="sxs-lookup"><span data-stu-id="387a8-172">The deployment guide provides step-by-step instructions for deploying and testing its components.</span></span>
